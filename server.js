const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');

const app = express();
const PORT = 3000; // ุงูุจูุฑุช ุงููู ุงูุณูุฑูุฑ ููุดุชุบู ุนููู

// ุฅุนุฏุงุฏุงุช ุฃุณุงุณูุฉ ุนุดุงู ููุจู ุงูุจูุงูุงุช ูู ุงูููุจุงูู
app.use(cors());
app.use(bodyParser.json());

// ุฏู ุฏุงุชุงุจูุฒ ููููุฉ (ูุตูููุฉ ูู ุงูุฐุงูุฑุฉ) ุจูุฎุฒู ูููุง ุงูููุฒุฑุฒ
// ููุญูุธุฉ: ูู ูููุช ุงูุจุฑูุงูุฌ ููุชุญุชู ุชุงููุ ุงูุจูุงูุงุช ุฏู ูุชุชูุณุญ
let users = [];

// ==========================================
// 1. API ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ (Register)
// ุงูุฑุงุจุท: http://10.0.2.2:3000/api/v1/auth/signup
// ==========================================
app.post('/api/v1/auth/signup', (req, res) => {
    const { name, email, password, phone } = req.body;

    // ุทุจุงุนุฉ ุงูุจูุงูุงุช ุงููู ุฌุงูุฉ ูู ุงูููุจุงูู ุนุดุงู ุชุดูููุง ูุฏุงูู
    console.log("๐ฅ ุทูุจ ุชุณุฌูู ุฌุฏูุฏ:", req.body);

    // 1. ุงูุชุฃูุฏ ุฅู ุงูุจูุงูุงุช ูุงููุฉ
    if (!name || !email || !password || !phone) {
        return res.status(400).json({ message: "ุจูุงูุงุช ูุงูุตุฉ! ุชุฃูุฏ ูู ุงูุงุณูุ ุงูุฅููููุ ูุงูุจุงุณูุฑุฏ" });
    }

    // 2. ุงูุชุฃูุฏ ุฅู ุงูุฅูููู ูุด ูุณุชุฎุฏู ูุจู ูุฏุฉ
    const userExists = users.find(u => u.email === email);
    if (userExists) {
        return res.status(400).json({ message: "ูุฐุง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุชุฎุฏู ุจุงููุนู" });
    }

    // 3. ุฅูุดุงุก ุงูููุฒุฑ ูุญูุธู ูู ุงููุตูููุฉ
    const newUser = {
        id: users.length + 1,
        name,
        email,
        password,
        phone
    };
    users.push(newUser);

    console.log("โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ:", newUser.email);

    // 4. ุงูุฑุฏ ุนูู ุงูููุจุงูู ุจูุฌุงุญ
    res.status(200).json({
        message: "ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ",
        user: newUser,
        token: "fake-jwt-token-" + Date.now() // ุชูููู ูููู
    });
});

// ==========================================
// 2. API ุชุณุฌูู ุงูุฏุฎูู (Login)
// ุงูุฑุงุจุท: http://10.0.2.2:3000/api/v1/auth/signin
// ==========================================
app.post('/api/v1/auth/signin', (req, res) => {
    const { email, password } = req.body;

    console.log("๐ฅ ูุญุงููุฉ ุฏุฎูู:", email);

    // 1. ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ุจุงูุฅูููู
    const user = users.find(u => u.email === email);

    // 2. ุงูุชุญูู ุฅู ุงูููุฒุฑ ููุฌูุฏ ูุงูุจุงุณูุฑุฏ ุตุญ
    if (!user || user.password !== password) {
        return res.status(401).json({ message: "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ" });
    }

    console.log("โ ุฏุฎูู ูุงุฌุญ:", user.email);

    // 3. ุงูุฑุฏ ุจูุฌุงุญ
    res.status(200).json({
        message: "ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ",
        user: user,
        token: "fake-jwt-token-" + Date.now()
    });
});

// ุชุดุบูู ุงูุณูุฑูุฑ
app.listen(PORT, () => {
    console.log(`๐ ุงูุณูุฑูุฑ ุดุบุงู ุฏูููุชู ูุง ุจุทู!`);
    console.log(`๐ ุนุดุงู ุงูุงููููุงุชูุฑ ูุดูููุ ุงุณุชุฎุฏู ุงูุฑุงุจุท ุฏู ูู ููุงุชุฑ: http://10.0.2.2:${PORT}`);
});